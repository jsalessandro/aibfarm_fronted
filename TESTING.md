# 页面输入自动化测试文档

## 测试概述

我们为 AIBFARM 前端应用构建了一套完整的页面输入自动化测试套件，覆盖所有主要用户交互场景和输入验证逻辑。

## 测试文件结构

```
src/components/__tests__/
├── Register.test.tsx          # 注册组件输入测试
├── Deposit.test.tsx          # 充值组件输入测试  
├── Login.test.tsx            # 登录组件输入测试
├── FormValidation.test.tsx   # 表单验证集成测试
├── UserInteractionFlow.test.tsx # 用户交互流程测试
└── basic.test.tsx           # 基础测试配置
```

## 测试覆盖功能

### 1. Register 组件测试 (Register.test.tsx)

**输入字段验证:**
- ✅ 所有必填字段渲染检查
- ✅ 输入类型正确性验证 (text, email, password)
- ✅ 用户输入接受和处理
- ✅ 字段值实时更新

**表单验证:**
- ✅ 空字段验证错误显示
- ✅ 邮箱格式验证 (正则表达式)
- ✅ 实时验证错误清除
- ✅ 复杂邮箱格式场景测试

**自动填充功能:**
- ✅ 自动填充模态框开启/关闭
- ✅ OKX 凭据解析和填充
- ✅ 多种格式支持 (= 分隔符, : 分隔符)
- ✅ 解析错误处理

**数据持久化:**
- ✅ LocalStorage 数据保存
- ✅ 页面刷新后数据恢复
- ✅ 保存数据清除功能
- ✅ 数据持久化指示器

**表单提交:**
- ✅ 有效数据 API 调用
- ✅ 加载状态按钮禁用
- ✅ 成功状态显示
- ✅ 输入数据去空格处理

### 2. Deposit 组件测试 (Deposit.test.tsx)

**基础输入测试:**
- ✅ 所有输入字段渲染 (用户名, 密码, 参考编号, 金额)
- ✅ 输入类型正确性 (text, password, number)
- ✅ 小数金额处理
- ✅ 用户输入实时响应

**快速金额选择:**
- ✅ 快速金额按钮渲染 (100, 500, 1000, 2000, 5000 USDT)
- ✅ 点击设置金额功能
- ✅ 选中状态高亮显示
- ✅ 金额切换更新

**账户操作:**
- ✅ 账户号码显示
- ✅ 复制到剪贴板功能
- ✅ 操作成功反馈

**帮助和指引:**
- ✅ 图片预览模态框 (参考编号, 金额示例)
- ✅ 步骤指引模态框
- ✅ 步骤详情展开/收起
- ✅ 模态框关闭功能

**表单验证:**
- ✅ 必填字段验证
- ✅ 金额有效性检查 (> 0)
- ✅ 验证错误实时清除
- ✅ 表单状态管理

**提交流程:**
- ✅ 确认对话框显示
- ✅ 信息确认展示
- ✅ API 调用处理
- ✅ 成功状态显示
- ✅ 加载状态管理

**数据持久化:**
- ✅ 用户名自动保存
- ✅ 跨会话用户名记忆
- ✅ 记忆状态指示器

### 3. Login 组件测试 (Login.test.tsx)

**基础功能:**
- ✅ 邮箱和密码输入字段
- ✅ 输入类型正确性
- ✅ 用户输入处理

**表单验证:**
- ✅ 空字段验证
- ✅ 邮箱格式验证
- ✅ 验证错误处理

**可访问性:**
- ✅ 标签关联正确
- ✅ ARIA 属性设置
- ✅ 键盘导航支持

### 4. 表单验证集成测试 (FormValidation.test.tsx)

**跨组件验证:**
- ✅ 多字段同时验证
- ✅ 渐进式字段验证
- ✅ 复杂邮箱验证场景
- ✅ 特殊字符处理

**验证状态管理:**
- ✅ 跨字段验证状态维护
- ✅ 实时验证反馈
- ✅ 错误消息可访问性

**数据约束测试:**
- ✅ 字段长度约束
- ✅ 数值精度处理
- ✅ 格式约束验证

### 5. 用户交互流程测试 (UserInteractionFlow.test.tsx)

**完整注册流程:**
- ✅ 手动输入完整流程
- ✅ 自动填充完整流程
- ✅ 表单持久化流程
- ✅ 成功状态处理

**完整充值流程:**
- ✅ 账户复制 → 步骤指引 → 表单填写 → 确认 → 提交
- ✅ 快速金额选择流程
- ✅ 帮助模态框交互
- ✅ 多模态框序列交互

**错误处理流程:**
- ✅ API 错误优雅处理
- ✅ 网络错误恢复
- ✅ 验证错误流程

**可访问性交互:**
- ✅ 键盘导航支持
- ✅ 屏幕阅读器支持
- ✅ ARIA 状态通知

## 测试技术栈

- **测试框架**: Vitest
- **React 测试**: React Testing Library
- **用户交互**: @testing-library/user-event
- **Mock 管理**: Vitest vi.mock
- **DOM 测试**: jsdom

## 测试运行命令

```bash
# 运行所有测试
npm run test:run

# 运行特定测试文件
npm run test:run src/components/__tests__/Register.test.tsx

# 运行特定测试案例
npm run test:run -t "should validate email format"

# 监听模式运行测试
npm run test
```

## Mock 配置

测试环境已配置以下 Mock:

- **API Services**: 模拟所有 API 调用
- **localStorage**: 完整的存储操作模拟
- **react-hot-toast**: 通知系统模拟
- **framer-motion**: 动画组件模拟
- **Clipboard API**: 剪贴板操作模拟

## 测试最佳实践

1. **用户中心测试**: 所有测试都从用户交互角度编写
2. **可访问性优先**: 使用语义化查询 (getByLabelText, getByRole)
3. **异步处理**: 正确处理所有异步操作和状态变化
4. **错误边界**: 覆盖各种错误场景和边界条件
5. **数据隔离**: 每个测试独立运行，无副作用
6. **真实场景**: 模拟真实用户操作流程

## 测试统计

- **总测试数量**: 84+ 个测试用例
- **组件覆盖率**: 100% 主要输入组件
- **功能覆盖率**: 覆盖所有用户输入场景
- **错误场景**: 完整的错误处理测试
- **可访问性**: 全面的可访问性合规测试

## 持续集成

测试套件已集成到 GitHub Actions 工作流中，每次代码推送都会自动运行所有测试，确保代码质量和功能完整性。

## 测试维护

- 新增输入功能时，请在对应测试文件中添加测试用例
- 修改现有功能时，请更新相关测试用例
- 确保所有测试在提交前通过
- 定期审查测试覆盖率和测试质量